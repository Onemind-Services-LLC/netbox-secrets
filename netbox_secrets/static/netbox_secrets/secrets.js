"use strict";(()=>{var P=Object.create;var b=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var C=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty;var _=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var H=(e,r,o,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of R(r))!D.call(e,i)&&i!==o&&b(e,i,{get:()=>r[i],enumerable:!(t=M(r,i))||t.enumerable});return e};var B=(e,r,o)=>(o=e!=null?P(C(e)):{},H(r||!e||!e.__esModule?b(o,"default",{value:e,enumerable:!0}):o,e));var p=(e,r,o)=>new Promise((t,i)=>{var s=c=>{try{a(o.next(c))}catch(l){i(l)}},n=c=>{try{a(o.throw(c))}catch(l){i(l)}},a=c=>c.done?t(c.value):Promise.resolve(c.value).then(s,n);a((o=o.apply(e,r)).next())});var h=_(E=>{"use strict";E.parse=O;E.serialize=q;var I=Object.prototype.toString,m=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function O(e,r){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var o={},t=r||{},i=t.decode||$,s=0;s<e.length;){var n=e.indexOf("=",s);if(n===-1)break;var a=e.indexOf(";",s);if(a===-1)a=e.length;else if(a<n){s=e.lastIndexOf(";",n-1)+1;continue}var c=e.slice(s,n).trim();if(o[c]===void 0){var l=e.slice(n+1,a).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1)),o[c]=F(l,i)}s=a+1}return o}function q(e,r,o){var t=o||{},i=t.encode||K;if(typeof i!="function")throw new TypeError("option encode is invalid");if(!m.test(e))throw new TypeError("argument name is invalid");var s=i(r);if(s&&!m.test(s))throw new TypeError("argument val is invalid");var n=e+"="+s;if(t.maxAge!=null){var a=t.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");n+="; Max-Age="+Math.floor(a)}if(t.domain){if(!m.test(t.domain))throw new TypeError("option domain is invalid");n+="; Domain="+t.domain}if(t.path){if(!m.test(t.path))throw new TypeError("option path is invalid");n+="; Path="+t.path}if(t.expires){var c=t.expires;if(!j(c)||isNaN(c.valueOf()))throw new TypeError("option expires is invalid");n+="; Expires="+c.toUTCString()}if(t.httpOnly&&(n+="; HttpOnly"),t.secure&&(n+="; Secure"),t.priority){var l=typeof t.priority=="string"?t.priority.toLowerCase():t.priority;switch(l){case"low":n+="; Priority=Low";break;case"medium":n+="; Priority=Medium";break;case"high":n+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(t.sameSite){var u=typeof t.sameSite=="string"?t.sameSite.toLowerCase():t.sameSite;switch(u){case!0:n+="; SameSite=Strict";break;case"lax":n+="; SameSite=Lax";break;case"strict":n+="; SameSite=Strict";break;case"none":n+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return n}function $(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e}function K(e){return encodeURIComponent(e)}function j(e){return I.call(e)==="[object Date]"||e instanceof Date}function F(e,r){try{return r(e)}catch(o){return e}}});function d(e,r,o,t){let i="mdi-alert";switch(e){case"warning":i="mdi-alert";break;case"success":i="mdi-check-circle";break;case"info":i="mdi-information";break;case"danger":i="mdi-alert";break}let s=document.createElement("div");s.setAttribute("class","toast-container position-fixed bottom-0 end-0 m-3");let n=document.createElement("div");n.setAttribute("class",`toast bg-${e}`),n.setAttribute("role","alert"),n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic","true");let a=document.createElement("div");a.setAttribute("class",`toast-header bg-${e} text-body`);let c=document.createElement("i");c.setAttribute("class",`mdi ${i}`);let l=document.createElement("strong");l.setAttribute("class","me-auto ms-1"),l.innerText=r;let u=document.createElement("button");u.setAttribute("type","button"),u.setAttribute("class","btn-close"),u.setAttribute("data-bs-dismiss","toast"),u.setAttribute("aria-label","Close");let y=document.createElement("div");if(y.setAttribute("class","toast-body"),a.appendChild(c),a.appendChild(l),typeof t!="undefined"){let g=document.createElement("small");g.setAttribute("class","text-muted"),a.appendChild(g)}return a.appendChild(u),y.innerText=o.trim(),n.appendChild(a),n.appendChild(y),s.appendChild(n),document.body.appendChild(s),new window.Toast(n)}var T=B(h());function A(e){return"error"in e&&"exception"in e}function f(e){return"error"in e}function v(e){return"value"in e&&"required"in e}function N(){let{csrftoken:e}=T.default.parse(document.cookie);if(typeof e=="undefined")throw new Error("Invalid or missing CSRF token");return e}function S(e,r,o){return p(this,null,function*(){let t=N(),i=new Headers({"X-CSRFToken":t}),s;typeof o!="undefined"&&(s=JSON.stringify(o),i.set("content-type","application/json"),i.set("Accept","application/json"));let n=yield fetch(e,{method:r,body:s,headers:i,credentials:"same-origin"}),a=n.headers.get("Content-Type");if(typeof a=="string"&&a.includes("text"))return{error:yield n.text()};let c=yield n.json();return!n.ok&&Array.isArray(c)?{error:c.join(`
`)}:!n.ok&&"detail"in c?{error:c.detail}:c})}function x(e,r){return p(this,null,function*(){return yield S(e,"POST",r)})}function k(e){return p(this,null,function*(){return yield S(e,"GET")})}function G(){let e=document.getElementById("new_keypair_modal"),r=document.getElementById("use_new_pubkey");if(e===null||r===null)return;let o=e.querySelector("textarea#new_pubkey"),t=e.querySelector("textarea#new_privkey");function i(){for(let n of[o,t])n!==null&&n.setAttribute("readonly","");k("/api/plugins/secrets/generate-rsa-key-pair/").then(n=>{if(f(n))d("danger","Error",n.error).show();else{let{private_key:a,public_key:c}=n;o!==null&&t!==null&&(o.value=c,t.value=a)}})}function s(){let n=document.getElementById("id_public_key");o!==null&&(n.value=o.value,n.innerText=o.value)}e.addEventListener("shown.bs.modal",()=>i()),r.addEventListener("click",()=>s())}function L(e,r){let o=document.querySelector(`button.unlock-secret[secret-id='${e}']`),t=document.querySelector(`button.lock-secret[secret-id='${e}']`),i=document.querySelector(`button.copy-secret[secret-id='${e}']`);o!==null&&(r==="unlock"&&o.classList.add("d-none"),r==="lock"&&o.classList.remove("d-none")),t!==null&&(r==="unlock"&&t.classList.remove("d-none"),r==="lock"&&t.classList.add("d-none")),i!==null&&(r==="unlock"&&i.classList.remove("d-none"),r==="lock"&&i.classList.add("d-none"))}function U(){let e=new window.Modal("#privkey_modal");function r(t){let i=document.getElementById(`secret_${t}`);typeof t=="string"&&t!==""&&k(`/api/plugins/secrets/secrets/${t}/`).then(s=>{if(f(s))s.error.toLowerCase().includes("invalid session key")?e.show():d("danger","Error",s.error).show();else{let{plaintext:n}=s;i!==null&&n!==null?(v(i)?i.value=n:i.innerText=n,L(t,"unlock")):e.show()}})}function o(t){if(typeof t=="string"&&t!==""){let i=document.getElementById(`secret_${t}`);v(i)?i.value="********":i.innerText="********",L(t,"lock")}}for(let t of document.querySelectorAll("button.unlock-secret"))t.addEventListener("click",()=>r(t.getAttribute("secret-id")));for(let t of document.querySelectorAll("button.lock-secret"))t.addEventListener("click",()=>o(t.getAttribute("secret-id")))}function z(e){x("/api/plugins/secrets/session-keys/",{private_key:e,preserve_key:!0}).then(r=>{if(!f(r))window.location.pathname==="/plugins/secrets/user-key/"?window.location.reload():d("success","Session Key Received","You may now unlock secrets.").show();else{let o=r.error;A(r)&&(o+=`
${r.exception}`),d("danger","Failed to Retrieve Session Key",o).show()}})}function J(){for(let r of document.querySelectorAll("#request_session_key")){let o=function(){for(let t of document.querySelectorAll("#user_privkey"))z(t.value),t.value=""};var e=o;r.addEventListener("click",o)}}function X(){let e=new window.Modal("#privkey_modal");function r(o){document.cookie.indexOf("netbox_secrets_sessionid")===-1&&(o.preventDefault(),e.show())}for(let o of document.querySelectorAll(".requires-session-key")){let t=o.closest("form");t!==null&&t.addEventListener("submit",r)}}function w(){for(let e of[G,U,J,X])e()}document.readyState!=="loading"?w():document.addEventListener("DOMContentLoaded",w);})();
/*! Bundled license information:

cookie/index.js:
  (*!
   * cookie
   * Copyright(c) 2012-2014 Roman Shtylman
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)
*/
//# sourceMappingURL=/static/netbox_secrets/secrets.js.map
