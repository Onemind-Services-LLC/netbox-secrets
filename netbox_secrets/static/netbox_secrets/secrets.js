"use strict";(()=>{var C=Object.create;var b=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var _=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var H=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var D=(e,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of B(n))!$.call(e,o)&&o!==t&&b(e,o,{get:()=>n[o],enumerable:!(r=M(n,o))||r.enumerable});return e};var O=(e,n,t)=>(t=e!=null?C(_(e)):{},D(n||!e||!e.__esModule?b(t,"default",{value:e,enumerable:!0}):t,e));var p=(e,n,t)=>new Promise((r,o)=>{var i=a=>{try{l(t.next(a))}catch(c){o(c)}},s=a=>{try{l(t.throw(a))}catch(c){o(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,s);l((t=t.apply(e,n)).next())});var T=H(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});y.parse=N;y.serialize=G;var q=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,j=/^[\u0021-\u003A\u003C-\u007E]*$/,K=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,U=/^[\u0020-\u003A\u003D-\u007E]*$/,z=Object.prototype.toString,F=(()=>{let e=function(){};return e.prototype=Object.create(null),e})();function N(e,n){let t=new F,r=e.length;if(r<2)return t;let o=(n==null?void 0:n.decode)||V,i=0;do{let s=e.indexOf("=",i);if(s===-1)break;let l=e.indexOf(";",i),a=l===-1?r:l;if(s>a){i=e.lastIndexOf(";",s-1)+1;continue}let c=h(e,i,s),d=v(e,s,c),u=e.slice(c,d);if(t[u]===void 0){let k=h(e,s+1,a),f=v(e,a,k),P=o(e.slice(k,f));t[u]=P}i=a+1}while(i<r);return t}function h(e,n,t){do{let r=e.charCodeAt(n);if(r!==32&&r!==9)return n}while(++n<t);return t}function v(e,n,t){for(;n>t;){let r=e.charCodeAt(--n);if(r!==32&&r!==9)return n+1}return t}function G(e,n,t){let r=(t==null?void 0:t.encode)||encodeURIComponent;if(!q.test(e))throw new TypeError(`argument name is invalid: ${e}`);let o=r(n);if(!j.test(o))throw new TypeError(`argument val is invalid: ${n}`);let i=e+"="+o;if(!t)return i;if(t.maxAge!==void 0){if(!Number.isInteger(t.maxAge))throw new TypeError(`option maxAge is invalid: ${t.maxAge}`);i+="; Max-Age="+t.maxAge}if(t.domain){if(!K.test(t.domain))throw new TypeError(`option domain is invalid: ${t.domain}`);i+="; Domain="+t.domain}if(t.path){if(!U.test(t.path))throw new TypeError(`option path is invalid: ${t.path}`);i+="; Path="+t.path}if(t.expires){if(!J(t.expires)||!Number.isFinite(t.expires.valueOf()))throw new TypeError(`option expires is invalid: ${t.expires}`);i+="; Expires="+t.expires.toUTCString()}if(t.httpOnly&&(i+="; HttpOnly"),t.secure&&(i+="; Secure"),t.partitioned&&(i+="; Partitioned"),t.priority)switch(typeof t.priority=="string"?t.priority.toLowerCase():void 0){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${t.priority}`)}if(t.sameSite)switch(typeof t.sameSite=="string"?t.sameSite.toLowerCase():t.sameSite){case!0:case"strict":i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"none":i+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${t.sameSite}`)}return i}function V(e){if(e.indexOf("%")===-1)return e;try{return decodeURIComponent(e)}catch(n){return e}}function J(e){return z.call(e)==="[object Date]"}});function m(e,n,t,r){let o="mdi-alert";switch(e){case"warning":o="mdi-alert";break;case"success":o="mdi-check-circle";break;case"info":o="mdi-information";break;case"danger":o="mdi-alert";break}let i=document.createElement("div");i.setAttribute("class","toast-container position-fixed bottom-0 end-0 m-3");let s=document.createElement("div");s.setAttribute("class",`toast bg-${e}`),s.setAttribute("role","alert"),s.setAttribute("aria-live","assertive"),s.setAttribute("aria-atomic","true");let l=document.createElement("div");l.setAttribute("class",`toast-header bg-${e} text-body`);let a=document.createElement("i");a.setAttribute("class",`mdi ${o}`);let c=document.createElement("strong");c.setAttribute("class","me-auto ms-1"),c.innerText=n;let d=document.createElement("button");d.setAttribute("type","button"),d.setAttribute("class","btn-close"),d.setAttribute("data-bs-dismiss","toast"),d.setAttribute("aria-label","Close");let u=document.createElement("div");if(u.setAttribute("class","toast-body"),l.appendChild(a),l.appendChild(c),typeof r!="undefined"){let f=document.createElement("small");f.setAttribute("class","text-muted"),l.appendChild(f)}return l.appendChild(d),u.innerText=t.trim(),s.appendChild(l),s.appendChild(u),i.appendChild(s),document.body.appendChild(i),new window.Toast(s)}var A=O(T());function L(e){return"error"in e&&"exception"in e}function E(e){return"error"in e}function w(e){return"value"in e&&"required"in e}function X(){let{csrftoken:e}=A.default.parse(document.cookie);if(typeof e=="undefined")throw new Error("Invalid or missing CSRF token");return e}function S(e,n,t){return p(this,null,function*(){let r=X(),o=new Headers({"X-CSRFToken":r}),i;typeof t!="undefined"&&(i=JSON.stringify(t),o.set("content-type","application/json"),o.set("Accept","application/json"));let s=yield fetch(e,{method:n,body:i,headers:o,credentials:"same-origin"}),l=s.headers.get("Content-Type");if(typeof l=="string"&&l.includes("text"))return{error:yield s.text()};let a=yield s.json();return!s.ok&&Array.isArray(a)?{error:a.join(`
`)}:!s.ok&&"detail"in a?{error:a.detail}:a})}function I(e,n){return p(this,null,function*(){return yield S(e,"POST",n)})}function x(e){return p(this,null,function*(){return yield S(e,"GET")})}function Y(){let e=document.getElementById("new_keypair_modal"),n=document.getElementById("use_new_pubkey"),t=document.getElementById("copy_prikey"),r=document.getElementById("export_key");if(e===null||n===null||t===null||r===null)return;let o=e.querySelector("textarea#new_pubkey"),i=e.querySelector("textarea#new_privkey");function s(){for(let c of[o,i])c!==null&&c.setAttribute("readonly","");x("/api/plugins/secrets/generate-rsa-key-pair/").then(c=>{if(E(c))m("danger","Error",c.error).show();else{let{private_key:d,public_key:u}=c;o!==null&&i!==null&&(o.value=u,i.value=d)}})}function l(){let c=document.getElementById("id_public_key");o!==null&&(c.value=o.value,c.innerText=o.value)}function a(){let c=`Public Key

${o==null?void 0:o.value}

Private Key

${i==null?void 0:i.value}`,d=new Blob([c],{type:"text/plain"}),u=document.createElement("a");u.style.display="none",u.href=window.URL.createObjectURL(d),u.download="key.txt",document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(u.href),document.body.removeChild(u)}e.addEventListener("shown.bs.modal",()=>s()),n.addEventListener("click",()=>l()),t.addEventListener("click",()=>navigator.clipboard.writeText((i==null?void 0:i.value)||"")),r.addEventListener("click",()=>a())}function R(e,n){let t=document.querySelector(`button.unlock-secret[secret-id='${e}']`),r=document.querySelector(`button.lock-secret[secret-id='${e}']`),o=document.querySelector(`span[secret-id='${e}']`);t!==null&&(n==="unlock"&&t.classList.add("d-none"),n==="lock"&&t.classList.remove("d-none")),r!==null&&(n==="unlock"&&r.classList.remove("d-none"),n==="lock"&&r.classList.add("d-none")),o!==null&&(n==="unlock"&&o.classList.remove("d-none"),n==="lock"&&o.classList.add("d-none"))}function Q(){let e=new window.Modal("#privkey_modal");function n(r){let o=document.getElementById(`secret_${r}`);typeof r=="string"&&r!==""&&x(`/api/plugins/secrets/secrets/${r}/`).then(i=>{if(E(i))i.error.toLowerCase().includes("invalid session key")?e.show():m("danger","Error",i.error).show();else{let{plaintext:s}=i;o!==null&&s!==null?(w(o)?o.value=s:o.innerText=s,R(r,"unlock")):e.show()}})}function t(r){if(typeof r=="string"&&r!==""){let o=document.getElementById(`secret_${r}`);w(o)?o.value="********":o.innerText="********",R(r,"lock")}}for(let r of document.querySelectorAll("button.unlock-secret"))r.addEventListener("click",()=>n(r.getAttribute("secret-id")));for(let r of document.querySelectorAll("button.lock-secret"))r.addEventListener("click",()=>t(r.getAttribute("secret-id")))}function W(e){I("/api/plugins/secrets/session-keys/",{private_key:e,preserve_key:!0}).then(n=>{if(E(n)){let t=n.error;L(n)&&(t+=`
${n.exception}`),m("danger","Failed to Retrieve Session Key",t).show()}else if(window.location.pathname==="/plugins/secrets/user-key/")window.location.reload();else{let t=m("success","Session Key Received","You may now unlock secrets.");window.location.reload(),t.show()}})}function Z(){for(let n of document.querySelectorAll("#request_session_key")){let t=function(){for(let r of document.querySelectorAll("#user_privkey"))W(r.value),r.value=""};var e=t;n.addEventListener("click",t)}}function ee(){let e=new window.Modal("#privkey_modal");function n(t){document.cookie.indexOf("netbox_secrets_sessionid")===-1&&(t.preventDefault(),e.show())}for(let t of document.querySelectorAll(".requires-session-key")){let r=t.closest("form");r!==null&&r.addEventListener("submit",n)}}function g(){for(let e of[Y,Q,Z,ee])e()}document.readyState!=="loading"?g():document.addEventListener("DOMContentLoaded",g);})();
//# sourceMappingURL=/static/netbox_secrets/secrets.js.map
