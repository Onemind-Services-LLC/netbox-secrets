"use strict";(()=>{var y=(e,o,t)=>new Promise((n,s)=>{var r=a=>{try{l(t.next(a))}catch(c){s(c)}},i=a=>{try{l(t.throw(a))}catch(c){s(c)}},l=a=>a.done?n(a.value):Promise.resolve(a.value).then(r,i);l((t=t.apply(e,o)).next())});function m(e,o,t,n){let s="mdi-alert";switch(e){case"warning":s="mdi-alert";break;case"success":s="mdi-check-circle";break;case"info":s="mdi-information";break;case"danger":s="mdi-alert";break}let r=document.createElement("div");r.setAttribute("class","toast-container position-fixed bottom-0 end-0 m-3");let i=document.createElement("div");i.setAttribute("class",`toast bg-${e}`),i.setAttribute("role","alert"),i.setAttribute("aria-live","assertive"),i.setAttribute("aria-atomic","true");let l=document.createElement("div");l.setAttribute("class",`toast-header bg-${e} text-body`);let a=document.createElement("i");a.setAttribute("class",`mdi ${s}`);let c=document.createElement("strong");c.setAttribute("class","me-auto ms-1"),c.innerText=o;let d=document.createElement("button");d.setAttribute("type","button"),d.setAttribute("class","btn-close"),d.setAttribute("data-bs-dismiss","toast"),d.setAttribute("aria-label","Close");let u=document.createElement("div");if(u.setAttribute("class","toast-body"),l.appendChild(a),l.appendChild(c),typeof n!="undefined"){let v=document.createElement("small");v.setAttribute("class","text-muted"),l.appendChild(v)}return l.appendChild(d),u.innerText=t.trim(),i.appendChild(l),i.appendChild(u),r.appendChild(i),document.body.appendChild(r),new window.Toast(i)}function k(e){return"error"in e&&"exception"in e}function f(e){return"error"in e}function w(e){return"value"in e&&"required"in e}function x(){let e=window.CSRF_TOKEN;if(typeof e=="undefined")throw new Error("Invalid or missing CSRF token");return e}function E(e,o,t){return y(this,null,function*(){let n=x(),s=new Headers({"X-CSRFToken":n}),r;typeof t!="undefined"&&(r=JSON.stringify(t),s.set("content-type","application/json"),s.set("Accept","application/json"));let i=yield fetch(e,{method:o,body:r,headers:s,credentials:"same-origin"});if(i.status===204)return{};let l=i.headers.get("Content-Type");if(typeof l=="string"&&l.includes("text"))return{error:yield i.text()};let a=yield i.json();return!i.ok&&Array.isArray(a)?{error:a.join(`
`)}:!i.ok&&"detail"in a?{error:a.detail}:a})}function T(e,o){return y(this,null,function*(){return yield E(e,"POST",o)})}function g(e){return y(this,null,function*(){return yield E(e,"GET")})}function p(e){let o=window.location.pathname||"",t=o.indexOf("/plugins/"),n=o.indexOf("/api/"),s=t>=0?t:n;return`${s>=0?o.slice(0,s):""}${e}`}function L(){let e=document.getElementById("new_keypair_modal"),o=document.getElementById("use_new_pubkey"),t=document.getElementById("copy_prikey"),n=document.getElementById("export_key");if(e===null||o===null||t===null||n===null)return;let s=e.querySelector("textarea#new_pubkey"),r=e.querySelector("textarea#new_privkey");function i(){for(let c of[s,r])c!==null&&c.setAttribute("readonly","");g(p("/api/plugins/secrets/generate-rsa-key-pair/")).then(c=>{if(f(c))m("danger","Error",c.error).show();else{let{private_key:d,public_key:u}=c;s!==null&&r!==null&&(s.value=u,r.value=d)}})}function l(){let c=document.getElementById("id_public_key");s!==null&&(c.value=s.value,c.innerText=s.value)}function a(){let c=`Public Key

${s==null?void 0:s.value}

Private Key

${r==null?void 0:r.value}`,d=new Blob([c],{type:"text/plain"}),u=document.createElement("a");u.style.display="none",u.href=window.URL.createObjectURL(d),u.download="key.txt",document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(u.href),document.body.removeChild(u)}e.addEventListener("shown.bs.modal",()=>i()),o.addEventListener("click",()=>l()),t.addEventListener("click",()=>navigator.clipboard.writeText((r==null?void 0:r.value)||"")),n.addEventListener("click",()=>a())}function h(e,o){let t=document.querySelector(`button.unlock-secret[secret-id='${e}']`),n=document.querySelector(`button.lock-secret[secret-id='${e}']`),s=document.querySelector(`span[secret-id='${e}']`);t!==null&&(o==="unlock"&&t.classList.add("d-none"),o==="lock"&&t.classList.remove("d-none")),n!==null&&(o==="unlock"&&n.classList.remove("d-none"),o==="lock"&&n.classList.add("d-none")),s!==null&&(o==="unlock"&&s.classList.remove("d-none"),o==="lock"&&s.classList.add("d-none"))}function A(){let e=new window.Modal("#privkey_modal");function o(n){let s=document.getElementById(`secret_${n}`);typeof n=="string"&&n!==""&&g(p(`/api/plugins/secrets/secrets/${n}/`)).then(r=>{if(f(r))r.error.toLowerCase().includes("invalid session key")?e.show():m("danger","Error",r.error).show();else{let{plaintext:i}=r;s!==null&&i!==null?(w(s)?s.value=i:s.innerText=i,h(n,"unlock")):e.show()}})}function t(n){if(typeof n=="string"&&n!==""){let s=document.getElementById(`secret_${n}`);w(s)?s.value="********":s.innerText="********",h(n,"lock")}}for(let n of document.querySelectorAll("button.unlock-secret"))n.addEventListener("click",()=>o(n.getAttribute("secret-id")));for(let n of document.querySelectorAll("button.lock-secret"))n.addEventListener("click",()=>t(n.getAttribute("secret-id")))}function S(e){T(p("/api/plugins/secrets/session-key/"),{private_key:e,preserve_key:!0}).then(o=>{if(f(o)){let t=o.error;k(o)&&(t+=`
${o.exception}`),m("danger","Failed to Retrieve Session Key",t).show()}else if(window.location.pathname===p("/plugins/secrets/user-key/"))window.location.reload();else{let t=m("success","Session Key Received","You may now unlock secrets.");window.location.reload(),t.show()}})}function R(e){E(p("/api/plugins/secrets/session-key/"),"DELETE").then(o=>{if(f(o)){let t=o.error;k(o)&&(t+=`
${o.exception}`),m("danger","Failed to Delete Session Key",t).show()}else{let t=m("success","Session Key Deleted","You can request a new session key when needed.");typeof e=="string"&&e!==""?window.location.href=e:window.location.reload(),t.show()}})}function B(){for(let o of document.querySelectorAll("#request_session_key")){let t=function(){for(let n of document.querySelectorAll("#user_privkey"))S(n.value),n.value=""};var e=t;o.addEventListener("click",t)}}function I(){for(let o of document.querySelectorAll(".delete-session-key")){let t=function(n){n.preventDefault();let s=o.getAttribute("data-return-url")||void 0;R(s)};var e=t;o.addEventListener("click",t)}}function P(){let e=new window.Modal("#privkey_modal");function o(t){document.cookie.indexOf("netbox_secrets_sessionid")===-1&&(t.preventDefault(),e.show())}for(let t of document.querySelectorAll(".requires-session-key")){let n=t.closest("form");n!==null&&n.addEventListener("submit",o)}}function b(){for(let e of[L,A,B,I,P])e()}document.readyState!=="loading"?b():document.addEventListener("DOMContentLoaded",b);})();
//# sourceMappingURL=/static/netbox_secrets/secrets.js.map
