"use strict";(()=>{var C=Object.create;var b=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var $=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty;var D=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var O=(e,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of _(n))!H.call(e,o)&&o!==t&&b(e,o,{get:()=>n[o],enumerable:!(r=M(n,o))||r.enumerable});return e};var q=(e,n,t)=>(t=e!=null?C($(e)):{},O(n||!e||!e.__esModule?b(t,"default",{value:e,enumerable:!0}):t,e));var y=(e,n,t)=>new Promise((r,o)=>{var i=a=>{try{l(t.next(a))}catch(c){o(c)}},s=a=>{try{l(t.throw(a))}catch(c){o(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,s);l((t=t.apply(e,n)).next())});var A=D(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});E.parse=G;E.serialize=V;var j=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,K=/^[\u0021-\u003A\u003C-\u007E]*$/,U=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,z=/^[\u0020-\u003A\u003D-\u007E]*$/,F=Object.prototype.toString,N=(()=>{let e=function(){};return e.prototype=Object.create(null),e})();function G(e,n){let t=new N,r=e.length;if(r<2)return t;let o=(n==null?void 0:n.decode)||J,i=0;do{let s=e.indexOf("=",i);if(s===-1)break;let l=e.indexOf(";",i),a=l===-1?r:l;if(s>a){i=e.lastIndexOf(";",s-1)+1;continue}let c=v(e,i,s),d=T(e,s,c),u=e.slice(c,d);if(t[u]===void 0){let w=v(e,s+1,a),p=T(e,a,w),B=o(e.slice(w,p));t[u]=B}i=a+1}while(i<r);return t}function v(e,n,t){do{let r=e.charCodeAt(n);if(r!==32&&r!==9)return n}while(++n<t);return t}function T(e,n,t){for(;n>t;){let r=e.charCodeAt(--n);if(r!==32&&r!==9)return n+1}return t}function V(e,n,t){let r=(t==null?void 0:t.encode)||encodeURIComponent;if(!j.test(e))throw new TypeError(`argument name is invalid: ${e}`);let o=r(n);if(!K.test(o))throw new TypeError(`argument val is invalid: ${n}`);let i=e+"="+o;if(!t)return i;if(t.maxAge!==void 0){if(!Number.isInteger(t.maxAge))throw new TypeError(`option maxAge is invalid: ${t.maxAge}`);i+="; Max-Age="+t.maxAge}if(t.domain){if(!U.test(t.domain))throw new TypeError(`option domain is invalid: ${t.domain}`);i+="; Domain="+t.domain}if(t.path){if(!z.test(t.path))throw new TypeError(`option path is invalid: ${t.path}`);i+="; Path="+t.path}if(t.expires){if(!X(t.expires)||!Number.isFinite(t.expires.valueOf()))throw new TypeError(`option expires is invalid: ${t.expires}`);i+="; Expires="+t.expires.toUTCString()}if(t.httpOnly&&(i+="; HttpOnly"),t.secure&&(i+="; Secure"),t.partitioned&&(i+="; Partitioned"),t.priority)switch(typeof t.priority=="string"?t.priority.toLowerCase():void 0){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${t.priority}`)}if(t.sameSite)switch(typeof t.sameSite=="string"?t.sameSite.toLowerCase():t.sameSite){case!0:case"strict":i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"none":i+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${t.sameSite}`)}return i}function J(e){if(e.indexOf("%")===-1)return e;try{return decodeURIComponent(e)}catch(n){return e}}function X(e){return F.call(e)==="[object Date]"}});function m(e,n,t,r){let o="mdi-alert";switch(e){case"warning":o="mdi-alert";break;case"success":o="mdi-check-circle";break;case"info":o="mdi-information";break;case"danger":o="mdi-alert";break}let i=document.createElement("div");i.setAttribute("class","toast-container position-fixed bottom-0 end-0 m-3");let s=document.createElement("div");s.setAttribute("class",`toast bg-${e}`),s.setAttribute("role","alert"),s.setAttribute("aria-live","assertive"),s.setAttribute("aria-atomic","true");let l=document.createElement("div");l.setAttribute("class",`toast-header bg-${e} text-body`);let a=document.createElement("i");a.setAttribute("class",`mdi ${o}`);let c=document.createElement("strong");c.setAttribute("class","me-auto ms-1"),c.innerText=n;let d=document.createElement("button");d.setAttribute("type","button"),d.setAttribute("class","btn-close"),d.setAttribute("data-bs-dismiss","toast"),d.setAttribute("aria-label","Close");let u=document.createElement("div");if(u.setAttribute("class","toast-body"),l.appendChild(a),l.appendChild(c),typeof r!="undefined"){let p=document.createElement("small");p.setAttribute("class","text-muted"),l.appendChild(p)}return l.appendChild(d),u.innerText=t.trim(),s.appendChild(l),s.appendChild(u),i.appendChild(s),document.body.appendChild(i),new window.Toast(s)}var L=q(A());function S(e){return"error"in e&&"exception"in e}function k(e){return"error"in e}function x(e){return"value"in e&&"required"in e}function Y(){let{csrftoken:e}=(0,L.parse)(document.cookie);if(typeof e=="undefined")throw new Error("Invalid or missing CSRF token");return e}function I(e,n,t){return y(this,null,function*(){let r=Y(),o=new Headers({"X-CSRFToken":r}),i;typeof t!="undefined"&&(i=JSON.stringify(t),o.set("content-type","application/json"),o.set("Accept","application/json"));let s=yield fetch(e,{method:n,body:i,headers:o,credentials:"same-origin"}),l=s.headers.get("Content-Type");if(typeof l=="string"&&l.includes("text"))return{error:yield s.text()};let a=yield s.json();return!s.ok&&Array.isArray(a)?{error:a.join(`
`)}:!s.ok&&"detail"in a?{error:a.detail}:a})}function P(e,n){return y(this,null,function*(){return yield I(e,"POST",n)})}function g(e){return y(this,null,function*(){return yield I(e,"GET")})}function f(e){let n=window.location.pathname||"",t=n.indexOf("/plugins/"),r=n.indexOf("/api/"),o=t>=0?t:r;return`${o>=0?n.slice(0,o):""}${e}`}function Q(){let e=document.getElementById("new_keypair_modal"),n=document.getElementById("use_new_pubkey"),t=document.getElementById("copy_prikey"),r=document.getElementById("export_key");if(e===null||n===null||t===null||r===null)return;let o=e.querySelector("textarea#new_pubkey"),i=e.querySelector("textarea#new_privkey");function s(){for(let c of[o,i])c!==null&&c.setAttribute("readonly","");g(f("/api/plugins/secrets/generate-rsa-key-pair/")).then(c=>{if(k(c))m("danger","Error",c.error).show();else{let{private_key:d,public_key:u}=c;o!==null&&i!==null&&(o.value=u,i.value=d)}})}function l(){let c=document.getElementById("id_public_key");o!==null&&(c.value=o.value,c.innerText=o.value)}function a(){let c=`Public Key

${o==null?void 0:o.value}

Private Key

${i==null?void 0:i.value}`,d=new Blob([c],{type:"text/plain"}),u=document.createElement("a");u.style.display="none",u.href=window.URL.createObjectURL(d),u.download="key.txt",document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(u.href),document.body.removeChild(u)}e.addEventListener("shown.bs.modal",()=>s()),n.addEventListener("click",()=>l()),t.addEventListener("click",()=>navigator.clipboard.writeText((i==null?void 0:i.value)||"")),r.addEventListener("click",()=>a())}function R(e,n){let t=document.querySelector(`button.unlock-secret[secret-id='${e}']`),r=document.querySelector(`button.lock-secret[secret-id='${e}']`),o=document.querySelector(`span[secret-id='${e}']`);t!==null&&(n==="unlock"&&t.classList.add("d-none"),n==="lock"&&t.classList.remove("d-none")),r!==null&&(n==="unlock"&&r.classList.remove("d-none"),n==="lock"&&r.classList.add("d-none")),o!==null&&(n==="unlock"&&o.classList.remove("d-none"),n==="lock"&&o.classList.add("d-none"))}function W(){let e=new window.Modal("#privkey_modal");function n(r){let o=document.getElementById(`secret_${r}`);typeof r=="string"&&r!==""&&g(f(`/api/plugins/secrets/secrets/${r}/`)).then(i=>{if(k(i))i.error.toLowerCase().includes("invalid session key")?e.show():m("danger","Error",i.error).show();else{let{plaintext:s}=i;o!==null&&s!==null?(x(o)?o.value=s:o.innerText=s,R(r,"unlock")):e.show()}})}function t(r){if(typeof r=="string"&&r!==""){let o=document.getElementById(`secret_${r}`);x(o)?o.value="********":o.innerText="********",R(r,"lock")}}for(let r of document.querySelectorAll("button.unlock-secret"))r.addEventListener("click",()=>n(r.getAttribute("secret-id")));for(let r of document.querySelectorAll("button.lock-secret"))r.addEventListener("click",()=>t(r.getAttribute("secret-id")))}function Z(e){P(f("/api/plugins/secrets/session-keys/"),{private_key:e,preserve_key:!0}).then(n=>{if(k(n)){let t=n.error;S(n)&&(t+=`
${n.exception}`),m("danger","Failed to Retrieve Session Key",t).show()}else if(window.location.pathname===f("/plugins/secrets/user-key/"))window.location.reload();else{let t=m("success","Session Key Received","You may now unlock secrets.");window.location.reload(),t.show()}})}function ee(){for(let n of document.querySelectorAll("#request_session_key")){let t=function(){for(let r of document.querySelectorAll("#user_privkey"))Z(r.value),r.value=""};var e=t;n.addEventListener("click",t)}}function te(){let e=new window.Modal("#privkey_modal");function n(t){document.cookie.indexOf("netbox_secrets_sessionid")===-1&&(t.preventDefault(),e.show())}for(let t of document.querySelectorAll(".requires-session-key")){let r=t.closest("form");r!==null&&r.addEventListener("submit",n)}}function h(){for(let e of[Q,W,ee,te])e()}document.readyState!=="loading"?h():document.addEventListener("DOMContentLoaded",h);})();
//# sourceMappingURL=/static/netbox_secrets/secrets.js.map
