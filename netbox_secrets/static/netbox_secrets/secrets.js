"use strict";(()=>{var B=Object.create;var b=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var $=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty;var D=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var O=(e,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of _(n))!H.call(e,i)&&i!==t&&b(e,i,{get:()=>n[i],enumerable:!(r=C(n,i))||r.enumerable});return e};var q=(e,n,t)=>(t=e!=null?B($(e)):{},O(n||!e||!e.__esModule?b(t,"default",{value:e,enumerable:!0}):t,e));var y=(e,n,t)=>new Promise((r,i)=>{var o=c=>{try{l(t.next(c))}catch(a){i(a)}},s=c=>{try{l(t.throw(c))}catch(a){i(a)}},l=c=>c.done?r(c.value):Promise.resolve(c.value).then(o,s);l((t=t.apply(e,n)).next())});var A=D(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});E.parse=N;E.serialize=V;var j=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,K=/^[\u0021-\u003A\u003C-\u007E]*$/,U=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,z=/^[\u0020-\u003A\u003D-\u007E]*$/,F=Object.prototype.toString,G=(()=>{let e=function(){};return e.prototype=Object.create(null),e})();function N(e,n){let t=new G,r=e.length;if(r<2)return t;let i=(n==null?void 0:n.decode)||J,o=0;do{let s=e.indexOf("=",o);if(s===-1)break;let l=e.indexOf(";",o),c=l===-1?r:l;if(s>c){o=e.lastIndexOf(";",s-1)+1;continue}let a=v(e,o,s),d=T(e,s,a),u=e.slice(a,d);if(t[u]===void 0){let w=v(e,s+1,c),p=T(e,c,w),M=i(e.slice(w,p));t[u]=M}o=c+1}while(o<r);return t}function v(e,n,t){do{let r=e.charCodeAt(n);if(r!==32&&r!==9)return n}while(++n<t);return t}function T(e,n,t){for(;n>t;){let r=e.charCodeAt(--n);if(r!==32&&r!==9)return n+1}return t}function V(e,n,t){let r=(t==null?void 0:t.encode)||encodeURIComponent;if(!j.test(e))throw new TypeError(`argument name is invalid: ${e}`);let i=r(n);if(!K.test(i))throw new TypeError(`argument val is invalid: ${n}`);let o=e+"="+i;if(!t)return o;if(t.maxAge!==void 0){if(!Number.isInteger(t.maxAge))throw new TypeError(`option maxAge is invalid: ${t.maxAge}`);o+="; Max-Age="+t.maxAge}if(t.domain){if(!U.test(t.domain))throw new TypeError(`option domain is invalid: ${t.domain}`);o+="; Domain="+t.domain}if(t.path){if(!z.test(t.path))throw new TypeError(`option path is invalid: ${t.path}`);o+="; Path="+t.path}if(t.expires){if(!X(t.expires)||!Number.isFinite(t.expires.valueOf()))throw new TypeError(`option expires is invalid: ${t.expires}`);o+="; Expires="+t.expires.toUTCString()}if(t.httpOnly&&(o+="; HttpOnly"),t.secure&&(o+="; Secure"),t.partitioned&&(o+="; Partitioned"),t.priority)switch(typeof t.priority=="string"?t.priority.toLowerCase():void 0){case"low":o+="; Priority=Low";break;case"medium":o+="; Priority=Medium";break;case"high":o+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${t.priority}`)}if(t.sameSite)switch(typeof t.sameSite=="string"?t.sameSite.toLowerCase():t.sameSite){case!0:case"strict":o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"none":o+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${t.sameSite}`)}return o}function J(e){if(e.indexOf("%")===-1)return e;try{return decodeURIComponent(e)}catch(n){return e}}function X(e){return F.call(e)==="[object Date]"}});function m(e,n,t,r){let i="mdi-alert";switch(e){case"warning":i="mdi-alert";break;case"success":i="mdi-check-circle";break;case"info":i="mdi-information";break;case"danger":i="mdi-alert";break}let o=document.createElement("div");o.setAttribute("class","toast-container position-fixed bottom-0 end-0 m-3");let s=document.createElement("div");s.setAttribute("class",`toast bg-${e}`),s.setAttribute("role","alert"),s.setAttribute("aria-live","assertive"),s.setAttribute("aria-atomic","true");let l=document.createElement("div");l.setAttribute("class",`toast-header bg-${e} text-body`);let c=document.createElement("i");c.setAttribute("class",`mdi ${i}`);let a=document.createElement("strong");a.setAttribute("class","me-auto ms-1"),a.innerText=n;let d=document.createElement("button");d.setAttribute("type","button"),d.setAttribute("class","btn-close"),d.setAttribute("data-bs-dismiss","toast"),d.setAttribute("aria-label","Close");let u=document.createElement("div");if(u.setAttribute("class","toast-body"),l.appendChild(c),l.appendChild(a),typeof r!="undefined"){let p=document.createElement("small");p.setAttribute("class","text-muted"),l.appendChild(p)}return l.appendChild(d),u.innerText=t.trim(),s.appendChild(l),s.appendChild(u),o.appendChild(s),document.body.appendChild(o),new window.Toast(s)}var L=q(A());function S(e){return"error"in e&&"exception"in e}function k(e){return"error"in e}function x(e){return"value"in e&&"required"in e}function Y(){let e=document.querySelector('input[name="csrfmiddlewaretoken"]');if(e&&e.value)return e.value;let{csrftoken:n}=L.default.parse(document.cookie);if(typeof n=="undefined")throw new Error("Invalid or missing CSRF token");return n}function I(e,n,t){return y(this,null,function*(){let r=new Headers;if(n!=="GET")try{let c=Y();r.set("X-CSRFToken",c)}catch(c){}let i;typeof t!="undefined"&&(i=JSON.stringify(t),r.set("content-type","application/json"),r.set("Accept","application/json"));let o=yield fetch(e,{method:n,body:i,headers:r,credentials:"same-origin"}),s=o.headers.get("Content-Type");if(typeof s=="string"&&s.includes("text"))return{error:yield o.text()};let l=yield o.json();return!o.ok&&Array.isArray(l)?{error:l.join(`
`)}:!o.ok&&"detail"in l?{error:l.detail}:l})}function P(e,n){return y(this,null,function*(){return yield I(e,"POST",n)})}function g(e){return y(this,null,function*(){return yield I(e,"GET")})}function f(e){let n=window.location.pathname||"",t=n.indexOf("/plugins/"),r=n.indexOf("/api/"),i=t>=0?t:r;return`${i>=0?n.slice(0,i):""}${e}`}function Q(){let e=document.getElementById("new_keypair_modal"),n=document.getElementById("use_new_pubkey"),t=document.getElementById("copy_prikey"),r=document.getElementById("export_key");if(e===null||n===null||t===null||r===null)return;let i=e.querySelector("textarea#new_pubkey"),o=e.querySelector("textarea#new_privkey");function s(){for(let a of[i,o])a!==null&&a.setAttribute("readonly","");g(f("/api/plugins/secrets/generate-rsa-key-pair/")).then(a=>{if(k(a))m("danger","Error",a.error).show();else{let{private_key:d,public_key:u}=a;i!==null&&o!==null&&(i.value=u,o.value=d)}})}function l(){let a=document.getElementById("id_public_key");i!==null&&(a.value=i.value,a.innerText=i.value)}function c(){let a=`Public Key

${i==null?void 0:i.value}

Private Key

${o==null?void 0:o.value}`,d=new Blob([a],{type:"text/plain"}),u=document.createElement("a");u.style.display="none",u.href=window.URL.createObjectURL(d),u.download="key.txt",document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(u.href),document.body.removeChild(u)}e.addEventListener("shown.bs.modal",()=>s()),n.addEventListener("click",()=>l()),t.addEventListener("click",()=>navigator.clipboard.writeText((o==null?void 0:o.value)||"")),r.addEventListener("click",()=>c())}function R(e,n){let t=document.querySelector(`button.unlock-secret[secret-id='${e}']`),r=document.querySelector(`button.lock-secret[secret-id='${e}']`),i=document.querySelector(`span[secret-id='${e}']`);t!==null&&(n==="unlock"&&t.classList.add("d-none"),n==="lock"&&t.classList.remove("d-none")),r!==null&&(n==="unlock"&&r.classList.remove("d-none"),n==="lock"&&r.classList.add("d-none")),i!==null&&(n==="unlock"&&i.classList.remove("d-none"),n==="lock"&&i.classList.add("d-none"))}function W(){let e=new window.Modal("#privkey_modal");function n(r){let i=document.getElementById(`secret_${r}`);typeof r=="string"&&r!==""&&g(f(`/api/plugins/secrets/secrets/${r}/`)).then(o=>{if(k(o))o.error.toLowerCase().includes("invalid session key")?e.show():m("danger","Error",o.error).show();else{let{plaintext:s}=o;i!==null&&s!==null?(x(i)?i.value=s:i.innerText=s,R(r,"unlock")):e.show()}})}function t(r){if(typeof r=="string"&&r!==""){let i=document.getElementById(`secret_${r}`);x(i)?i.value="********":i.innerText="********",R(r,"lock")}}for(let r of document.querySelectorAll("button.unlock-secret"))r.addEventListener("click",()=>n(r.getAttribute("secret-id")));for(let r of document.querySelectorAll("button.lock-secret"))r.addEventListener("click",()=>t(r.getAttribute("secret-id")))}function Z(e){P(f("/api/plugins/secrets/session-keys/"),{private_key:e,preserve_key:!0}).then(n=>{if(k(n)){let t=n.error;S(n)&&(t+=`
${n.exception}`),m("danger","Failed to Retrieve Session Key",t).show()}else if(window.location.pathname===f("/plugins/secrets/user-key/"))window.location.reload();else{let t=m("success","Session Key Received","You may now unlock secrets.");window.location.reload(),t.show()}})}function ee(){for(let n of document.querySelectorAll("#request_session_key")){let t=function(){for(let r of document.querySelectorAll("#user_privkey"))Z(r.value),r.value=""};var e=t;n.addEventListener("click",t)}}function te(){let e=new window.Modal("#privkey_modal");function n(t){document.cookie.indexOf("netbox_secrets_sessionid")===-1&&(t.preventDefault(),e.show())}for(let t of document.querySelectorAll(".requires-session-key")){let r=t.closest("form");r!==null&&r.addEventListener("submit",n)}}function h(){for(let e of[Q,W,ee,te])e()}document.readyState!=="loading"?h():document.addEventListener("DOMContentLoaded",h);})();
//# sourceMappingURL=/static/netbox_secrets/secrets.js.map
