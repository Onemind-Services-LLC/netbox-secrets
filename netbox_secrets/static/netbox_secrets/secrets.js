"use strict";(()=>{var f=(e,r,o)=>new Promise((t,n)=>{var s=a=>{try{l(o.next(a))}catch(c){n(c)}},i=a=>{try{l(o.throw(a))}catch(c){n(c)}},l=a=>a.done?t(a.value):Promise.resolve(a.value).then(s,i);l((o=o.apply(e,r)).next())});function m(e,r,o,t){let n="mdi-alert";switch(e){case"warning":n="mdi-alert";break;case"success":n="mdi-check-circle";break;case"info":n="mdi-information";break;case"danger":n="mdi-alert";break}let s=document.createElement("div");s.setAttribute("class","toast-container position-fixed bottom-0 end-0 m-3");let i=document.createElement("div");i.setAttribute("class",`toast bg-${e}`),i.setAttribute("role","alert"),i.setAttribute("aria-live","assertive"),i.setAttribute("aria-atomic","true");let l=document.createElement("div");l.setAttribute("class",`toast-header bg-${e} text-body`);let a=document.createElement("i");a.setAttribute("class",`mdi ${n}`);let c=document.createElement("strong");c.setAttribute("class","me-auto ms-1"),c.innerText=r;let d=document.createElement("button");d.setAttribute("type","button"),d.setAttribute("class","btn-close"),d.setAttribute("data-bs-dismiss","toast"),d.setAttribute("aria-label","Close");let u=document.createElement("div");if(u.setAttribute("class","toast-body"),l.appendChild(a),l.appendChild(c),typeof t!="undefined"){let w=document.createElement("small");w.setAttribute("class","text-muted"),l.appendChild(w)}return l.appendChild(d),u.innerText=o.trim(),i.appendChild(l),i.appendChild(u),s.appendChild(i),document.body.appendChild(s),new window.Toast(i)}function g(e){return"error"in e&&"exception"in e}function y(e){return"error"in e}function E(e){return"value"in e&&"required"in e}function h(){let e=window.CSRF_TOKEN;if(typeof e=="undefined")throw new Error("Invalid or missing CSRF token");return e}function v(e,r,o){return f(this,null,function*(){let t=h(),n=new Headers({"X-CSRFToken":t}),s;typeof o!="undefined"&&(s=JSON.stringify(o),n.set("content-type","application/json"),n.set("Accept","application/json"));let i=yield fetch(e,{method:r,body:s,headers:n,credentials:"same-origin"}),l=i.headers.get("Content-Type");if(typeof l=="string"&&l.includes("text"))return{error:yield i.text()};let a=yield i.json();return!i.ok&&Array.isArray(a)?{error:a.join(`
`)}:!i.ok&&"detail"in a?{error:a.detail}:a})}function T(e,r){return f(this,null,function*(){return yield v(e,"POST",r)})}function k(e){return f(this,null,function*(){return yield v(e,"GET")})}function p(e){let r=window.location.pathname||"",o=r.indexOf("/plugins/"),t=r.indexOf("/api/"),n=o>=0?o:t;return`${n>=0?r.slice(0,n):""}${e}`}function L(){let e=document.getElementById("new_keypair_modal"),r=document.getElementById("use_new_pubkey"),o=document.getElementById("copy_prikey"),t=document.getElementById("export_key");if(e===null||r===null||o===null||t===null)return;let n=e.querySelector("textarea#new_pubkey"),s=e.querySelector("textarea#new_privkey");function i(){for(let c of[n,s])c!==null&&c.setAttribute("readonly","");k(p("/api/plugins/secrets/generate-rsa-key-pair/")).then(c=>{if(y(c))m("danger","Error",c.error).show();else{let{private_key:d,public_key:u}=c;n!==null&&s!==null&&(n.value=u,s.value=d)}})}function l(){let c=document.getElementById("id_public_key");n!==null&&(c.value=n.value,c.innerText=n.value)}function a(){let c=`Public Key

${n==null?void 0:n.value}

Private Key

${s==null?void 0:s.value}`,d=new Blob([c],{type:"text/plain"}),u=document.createElement("a");u.style.display="none",u.href=window.URL.createObjectURL(d),u.download="key.txt",document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(u.href),document.body.removeChild(u)}e.addEventListener("shown.bs.modal",()=>i()),r.addEventListener("click",()=>l()),o.addEventListener("click",()=>navigator.clipboard.writeText((s==null?void 0:s.value)||"")),t.addEventListener("click",()=>a())}function x(e,r){let o=document.querySelector(`button.unlock-secret[secret-id='${e}']`),t=document.querySelector(`button.lock-secret[secret-id='${e}']`),n=document.querySelector(`span[secret-id='${e}']`);o!==null&&(r==="unlock"&&o.classList.add("d-none"),r==="lock"&&o.classList.remove("d-none")),t!==null&&(r==="unlock"&&t.classList.remove("d-none"),r==="lock"&&t.classList.add("d-none")),n!==null&&(r==="unlock"&&n.classList.remove("d-none"),r==="lock"&&n.classList.add("d-none"))}function A(){let e=new window.Modal("#privkey_modal");function r(t){let n=document.getElementById(`secret_${t}`);typeof t=="string"&&t!==""&&k(p(`/api/plugins/secrets/secrets/${t}/`)).then(s=>{if(y(s))s.error.toLowerCase().includes("invalid session key")?e.show():m("danger","Error",s.error).show();else{let{plaintext:i}=s;n!==null&&i!==null?(E(n)?n.value=i:n.innerText=i,x(t,"unlock")):e.show()}})}function o(t){if(typeof t=="string"&&t!==""){let n=document.getElementById(`secret_${t}`);E(n)?n.value="********":n.innerText="********",x(t,"lock")}}for(let t of document.querySelectorAll("button.unlock-secret"))t.addEventListener("click",()=>r(t.getAttribute("secret-id")));for(let t of document.querySelectorAll("button.lock-secret"))t.addEventListener("click",()=>o(t.getAttribute("secret-id")))}function B(e){T(p("/api/plugins/secrets/session-keys/"),{private_key:e,preserve_key:!0}).then(r=>{if(y(r)){let o=r.error;g(r)&&(o+=`
${r.exception}`),m("danger","Failed to Retrieve Session Key",o).show()}else if(window.location.pathname===p("/plugins/secrets/user-key/"))window.location.reload();else{let o=m("success","Session Key Received","You may now unlock secrets.");window.location.reload(),o.show()}})}function I(){for(let r of document.querySelectorAll("#request_session_key")){let o=function(){for(let t of document.querySelectorAll("#user_privkey"))B(t.value),t.value=""};var e=o;r.addEventListener("click",o)}}function S(){let e=new window.Modal("#privkey_modal");function r(o){document.cookie.indexOf("netbox_secrets_sessionid")===-1&&(o.preventDefault(),e.show())}for(let o of document.querySelectorAll(".requires-session-key")){let t=o.closest("form");t!==null&&t.addEventListener("submit",r)}}function b(){for(let e of[L,A,I,S])e()}document.readyState!=="loading"?b():document.addEventListener("DOMContentLoaded",b);})();
//# sourceMappingURL=/static/netbox_secrets/secrets.js.map
