name: CI

on:
  - push
  - pull_request

# Add concurrency group to control job running
concurrency:
  group: ${{ github.event_name }}-${{ github.ref }}-${{ github.actor }}
  cancel-in-progress: true

permissions:
  checks: write
  contents: read
  pull-requests: write

jobs:
  js_quality:
    name: JavaScript Quality
    uses: Onemind-Services-LLC/actions/.github/workflows/js-quality-checks.yml@master
    with:
      working-directory: 'netbox_secrets/project-static'
      bundle-dist-path: 'netbox_secrets/project-static/dist'
      eslint-args: './src/**/*.ts'
      patterns: '**/*.+(ts|tsx)'
      run-browserslist: false
      run-bundle-check: true
      run-typescript: true

  test:
    name: Run Tests
    uses: Onemind-Services-LLC/actions/.github/workflows/netbox-plugin-tests.yml@4a0016a6489e15a9efc8cc6f655d43a899b3d4d4
    needs: js_quality
    with:
      app-id: ${{ vars.APP_ID }}
      plugin-name: 'netbox_secrets'
    secrets:
      private-key: ${{ secrets.APP_PRIVATE_KEY }}
